<!DOCTYPE html>
<html>
<head>
  <title>GPS Transporte Burrigo</title>
</head>
<body>
  <h3>Enviando ubicación en tiempo real...</h3>
  <p>Deja esta página abierta y asegúrate de dar permiso de ubicación.</p>
  <p id="estado">Esperando ubicación...</p>
  <script>
    // Pon aquí la URL pública de tu backend Railway con el endpoint /ubicacion
    const URL_UPDATE = 'https://backend-production-79bd.up.railway.app/ubicacion';

    function actualizarEstado(mensaje) {
      document.getElementById('estado').innerText = mensaje;
    }

    function enviarUbicacion(pos) {
      const data = {
        latitud: pos.coords.latitude,
        longitud: pos.coords.longitude,
        timestamp: new Date().toISOString()
      };

      actualizarEstado(`Ubicación: ${data.latitud}, ${data.longitud}. Enviando...`);

      fetch(URL_UPDATE, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(data)
      })
      .then(response => {
        if (response.ok) {
          actualizarEstado(`¡Ubicación enviada! Lat: ${data.latitud.toFixed(4)}`);
        } else {
          actualizarEstado('ERROR: Servidor Flask devolvió un código de error.');
        }
      })
      .catch(error => {
        actualizarEstado('ERROR: No se pudo conectar con el servidor.');
      });
    }

    function manejarError(err) {
      let mensaje = '';
      switch(err.code) {
        case err.PERMISSION_DENIED:
          mensaje = "ERROR: Permiso de ubicación denegado por el usuario.";
          break;
        case err.POSITION_UNAVAILABLE:
          mensaje = "ERROR: La información de ubicación no está disponible.";
          break;
        case err.TIMEOUT:
          mensaje = "ERROR: Tiempo de espera agotado para obtener la ubicación.";
          break;
        default:
          mensaje = `ERROR desconocido: ${err.message}`;
      }
      actualizarEstado(mensaje);
    }

    const opciones = {
      enableHighAccuracy: true,
      maximumAge: 5000,
      timeout: 10000
    };

    if (navigator.geolocation) {
      actualizarEstado("Solicitando permiso de ubicación...");
      navigator.geolocation.watchPosition(enviarUbicacion, manejarError, opciones);
    } else {
      actualizarEstado("ERROR: Tu navegador no soporta Geolocation.");
    }
  </script>
</body>
</html>
